<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국어 PDF 오탈자 검수 결과 뷰어</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6B7280',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- 헤더 -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">한국어 PDF 오탈자 검수 결과</h1>
            <p class="text-gray-600">검수된 PDF의 오탈자, 맞춤법, 띄어쓰기 오류를 확인하세요</p>
        </header>

        <!-- 파일 업로드 섹션 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">검수 결과 파일 업로드</h2>
            <div class="flex items-center space-x-4">
                <input type="file" id="csvFile" accept=".csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/90">
                <button onclick="loadCSV()" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">로드</button>
            </div>
            <p class="text-sm text-gray-500 mt-2">CSV 파일을 선택하고 로드 버튼을 클릭하세요</p>
        </div>

        <!-- 통계 섹션 -->
        <div id="statsSection" class="hidden bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">검수 통계</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600" id="totalPages">0</div>
                    <div class="text-sm text-blue-600">총 페이지</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-green-600" id="totalSentences">0</div>
                    <div class="text-sm text-green-600">총 문장</div>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-yellow-600" id="flaggedSentences">0</div>
                    <div class="text-sm text-yellow-600">오류 발견</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-red-600" id="detectionRate">0%</div>
                    <div class="text-sm text-red-600">검출률</div>
                </div>
            </div>
        </div>

        <!-- 필터 섹션 -->
        <div id="filterSection" class="hidden bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">필터</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">페이지 범위</label>
                    <div class="flex space-x-2">
                        <input type="number" id="pageFrom" placeholder="시작" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                        <span class="text-gray-500 self-center">~</span>
                        <input type="number" id="pageTo" placeholder="끝" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">검사기</label>
                    <select id="sourceFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">전체</option>
                        <option value="hanspell">Hanspell</option>
                        <option value="spacing">PyKoSpacing</option>
                        <option value="rule">규칙 기반</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">오류 유형</label>
                    <select id="errorTypeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">전체</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button onclick="applyFilters()" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">필터 적용</button>
                </div>
            </div>
        </div>

        <!-- 결과 테이블 -->
        <div id="resultsSection" class="hidden bg-white rounded-lg shadow-md overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900">검수 결과</h2>
                <p class="text-sm text-gray-600 mt-1">총 <span id="resultCount">0</span>건의 오류가 발견되었습니다</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">페이지</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">문장</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">검사기</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">오류 유형</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">교정 제안</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diff</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- 결과가 여기에 동적으로 추가됩니다 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 로딩 표시 -->
        <div id="loadingSection" class="hidden text-center py-12">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
            <p class="mt-2 text-gray-600">파일을 처리하는 중...</p>
        </div>

        <!-- 오류 메시지 -->
        <div id="errorSection" class="hidden bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-red-800" id="errorMessage"></p>
        </div>
    </div>

    <script>
        let csvData = [];
        let filteredData = [];

        function loadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showError('파일을 선택해주세요.');
                return;
            }

            showLoading(true);
            showError(false);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    csvData = parseCSV(csv);
                    filteredData = [...csvData];
                    
                    showLoading(false);
                    displayResults();
                    updateStats();
                    populateFilters();
                } catch (error) {
                    showLoading(false);
                    showError('CSV 파일을 파싱하는 중 오류가 발생했습니다: ' + error.message);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }

            return data;
        }

        function displayResults() {
            const resultsSection = document.getElementById('resultsSection');
            const filterSection = document.getElementById('filterSection');
            const statsSection = document.getElementById('statsSection');
            
            resultsSection.classList.remove('hidden');
            filterSection.classList.remove('hidden');
            statsSection.classList.remove('hidden');

            updateTable();
        }

        function updateTable() {
            const tbody = document.getElementById('resultsTableBody');
            const resultCount = document.getElementById('resultCount');
            
            resultCount.textContent = filteredData.length;
            
            tbody.innerHTML = '';
            
            filteredData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.page || ''}</td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <div class="truncate" title="${row.sentence || ''}">${row.sentence || ''}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${row.sources || ''}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            ${row.error_types || ''}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <div class="truncate" title="${row.representative_suggestion || ''}">${row.representative_suggestion || ''}</div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <div class="truncate font-mono text-xs" title="${row.diff || ''}">${row.diff || ''}</div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function updateStats() {
            if (csvData.length === 0) return;

            const pages = new Set(csvData.map(row => row.page)).size;
            const totalSentences = csvData.length;
            const flaggedSentences = csvData.length;
            const detectionRate = totalSentences > 0 ? Math.round((flaggedSentences / totalSentences) * 100) : 0;

            document.getElementById('totalPages').textContent = pages;
            document.getElementById('totalSentences').textContent = totalSentences.toLocaleString();
            document.getElementById('flaggedSentences').textContent = flaggedSentences.toLocaleString();
            document.getElementById('detectionRate').textContent = detectionRate + '%';
        }

        function populateFilters() {
            if (csvData.length === 0) return;

            // 오류 유형 필터 옵션 생성
            const errorTypes = new Set();
            csvData.forEach(row => {
                if (row.error_types) {
                    row.error_types.split(',').forEach(type => {
                        errorTypes.add(type.trim());
                    });
                }
            });

            const errorTypeFilter = document.getElementById('errorTypeFilter');
            errorTypeFilter.innerHTML = '<option value="">전체</option>';
            Array.from(errorTypes).sort().forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                errorTypeFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const pageFrom = parseInt(document.getElementById('pageFrom').value) || 0;
            const pageTo = parseInt(document.getElementById('pageTo').value) || 999999;
            const sourceFilter = document.getElementById('sourceFilter').value;
            const errorTypeFilter = document.getElementById('errorTypeFilter').value;

            filteredData = csvData.filter(row => {
                const page = parseInt(row.page) || 0;
                const pageMatch = page >= pageFrom && page <= pageTo;
                
                const sourceMatch = !sourceFilter || (row.sources && row.sources.includes(sourceFilter));
                
                const errorTypeMatch = !errorTypeFilter || (row.error_types && row.error_types.includes(errorTypeFilter));
                
                return pageMatch && sourceMatch && errorTypeMatch;
            });

            updateTable();
        }

        function showLoading(show) {
            const loadingSection = document.getElementById('loadingSection');
            if (show) {
                loadingSection.classList.remove('hidden');
            } else {
                loadingSection.classList.add('hidden');
            }
        }

        function showError(show, message = '') {
            const errorSection = document.getElementById('errorSection');
            const errorMessage = document.getElementById('errorMessage');
            
            if (show) {
                errorSection.classList.remove('hidden');
                errorMessage.textContent = message;
            } else {
                errorSection.classList.add('hidden');
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('한국어 PDF 오탈자 검수 결과 뷰어가 로드되었습니다.');
        });
    </script>
</body>
</html>
